<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Happy Birthday Misha üéâ</title>

  <style>
    :root{
      --bg1:#fffdf8;
      --bg2:#ffeef5;
      --accent:#ff70a6;
      --muted:#6b7280;
      --card:#ffffff;
      --radius:18px;
      --maxw:1200px;
      --hero-bg:#ffe6f1;
      --section-height:420px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Poppins",system-ui,sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      padding:28px 18px;
      display:flex;
      justify-content:center;
      overflow-x:hidden;
    }
    .wrap{ width:100%; max-width:var(--maxw); position:relative; }

    .hero-title {
      font-family: "Poppins", sans-serif;
      font-size: 44px;
      font-weight: 900;
      color: #ff77b7;
      text-shadow: 0px 3px 10px rgba(255, 150, 200, 0.25);
      letter-spacing: 1px;
      animation: bounce 1.5s ease infinite;
    }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }

    /* Music control (top-right) */
    .music-control{ position:fixed; right:18px; top:18px; z-index:20000; display:flex; gap:8px; align-items:center; background:rgba(255,255,255,0.9); padding:8px 10px; border-radius:999px; box-shadow:0 8px 20px rgba(0,0,0,0.06); }
    .music-btn{ background:var(--accent); color:white; border:0; padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:700; }
    .music-status{ font-size:13px; color:var(--muted); }

    /* ---------- HERO ---------- */
    .hero-large{ display:grid; grid-template-columns:1fr; gap:20px; margin-bottom:22px; }
    @media(min-width:980px){ .hero-large{ grid-template-columns:1fr 1.2fr; } }

    .hero-card{ background:var(--hero-bg); border-radius:24px; padding:34px; box-shadow:0 12px 40px rgba(0,0,0,0.06); display:flex; flex-direction:column; justify-content:center; min-height:var(--section-height); }
    .hero-photo-wrap{ border-radius:24px; overflow:hidden; box-shadow:0 12px 40px rgba(0,0,0,0.09); min-height:var(--section-height); position:relative; }
    .hero-photo{ width:100%; height:100%; object-fit:cover; display:block; cursor:pointer; }

    .hero-sub{ margin:14px 0 0; font-size:16px; color:#555; line-height:1.5; white-space:pre-line; }
    .hero-meta{ margin-top:20px; display:flex; align-items:center; gap:14px; }
    .pill{ background:white; padding:10px 16px; border-radius:999px; font-weight:700; box-shadow:0 8px 18px rgba(255,90,140,0.15); }
    .celebrate-btn{ background:#ff4d82; color:white; border:none; padding:10px 20px; border-radius:999px; cursor:pointer; font-weight:700; }

    /* GALLERY (2x2 on desktop, 1 column on mobile) */
    .gallery-grid{ display:grid; grid-template-columns:1fr; gap:18px; margin-top:12px; }
    @media(min-width:700px){ .gallery-grid{ grid-template-columns:1fr 1fr; } }

    .photo{ width:100%; height:420px; object-fit:cover; border-radius:16px; cursor:pointer; transition:transform .22s, box-shadow .22s; display:block; }
    @media(max-width:700px){ .photo{ height:320px; } }
    .photo:hover{ transform:scale(1.02); box-shadow:0 12px 30px rgba(0,0,0,0.14); }

    /* CARD */
    .card{ background:white; padding:20px; border-radius:16px; box-shadow:0 8px 25px rgba(0,0,0,0.06); margin-top:18px; }
    .wishes-card{ min-height:var(--section-height); }

    /* MODAL */
    .modal-wrap{ position:fixed; inset:0; background:rgba(0,0,0,0.72); display:flex; justify-content:center; align-items:center; padding:24px; z-index:9999; }
    .modal-content{ max-width:1100px; width:100%; display:flex; gap:18px; align-items:flex-start; }
    .modal-img{ width:60%; max-height:80vh; object-fit:contain; border-radius:12px; background:#000; }
    .modal-controls{ width:40%; display:flex; flex-direction:column; gap:10px; color:white; }
    .modal-controls .title{ font-weight:700; font-size:20px; }
    .modal-controls button{ padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700; }
    .close-btn{ background:rgba(255,255,255,0.15); color:white; }

    /* TIMELINE */
    .timeline{ display:flex; flex-direction:column; gap:16px; margin-top:12px; }
    .tm-item{ display:flex; gap:12px; align-items:flex-start; }
    .tm-thumb img{ width:80px; height:80px; border-radius:12px; object-fit:cover; }

    /* WISHES */
    .wishes-form input, .wishes-form textarea{ width:100%; padding:12px; border-radius:12px; border:1px solid #e7e7e7; }
    .wish{ background:#fff0fb; border-radius:12px; padding:12px; margin-bottom:12px; border:1px solid #f7cce9; }
    footer{ margin-top:30px; text-align:center; font-weight:600; color:var(--muted); }

    .hint{ font-size:13px; color:var(--muted) }

    /* CELEBRATION: rose sparkles + pink petals (updated: slower & more distributed) */
    .celebration-layer{ pointer-events:none; position:fixed; inset:0; z-index:15000; overflow:hidden; }
    .rose-emoji, .petal {
      position:absolute;
      font-size:22px;
      will-change:transform,opacity;
      user-select:none;
      pointer-events:none;
    }
    .petal{ font-size:18px; opacity:0.95; }

    /* slower, longer rise for roses */
    @keyframes riseFade {
      0% { transform: translateY(0) scale(1) rotate(0deg); opacity:1; }
      40% { opacity:1; transform: translateY(-80px) scale(1.05) rotate(20deg); }
      100% { transform: translateY(-360px) scale(0.85) rotate(420deg); opacity:0; }
    }
    @keyframes floatUp {
      0% { transform: translateY(0) scale(1) rotate(0deg); opacity:1; }
      100% { transform: translateY(-300px) scale(0.8) rotate(360deg); opacity:0; }
    }

    /* small responsive tweaks */
    @media(max-width:520px){
      .modal-content{ flex-direction:column; }
      .modal-img{ width:100%; height:auto; }
      .modal-controls{ width:100%; }
      .hero-title{ font-size:28px; }
    }
  </style>
</head>
<body>

  <div class="music-control" role="region" aria-label="Music controls">
    <div class="music-status" id="musicStatus">Music: Paused</div>
    <button id="musicToggle" class="music-btn" aria-pressed="false">Play</button>
  </div>

  <!-- celebration DOM layer -->
  <div id="celebrationLayer" class="celebration-layer" aria-hidden="true"></div>

  <div class="wrap">

    <!-- HERO -->
    <section class="hero-large">
      <div class="hero-card">
        <h1 class="hero-title">üéâ Happy Birthday Misha~</h1>

        <p class="hero-sub" id="birthdayNote">
Happy Birthday, Misha~
Ek saal se hum dost hain, aur honestly, tumhari vibe hi sabse alag hai ‚Äî nature itna achha, itna calm aur sweet ki koi bhi tumse instantly comfortable ho jata hai. Tum dance me already amazing ho, aur cultural head hone ka confidence tumhari personality ko aur bhi standout banata hai.
Aur jab tum woh ‚Äúhainnn?‚Äù bolti ho na‚Ä¶ trust me, uss moment tum itni cute lagti ho ki banda chahe bhi toh ignore nahi kar sakta üòÑüíó Tumhari smile, tumhara energy ‚Äî sab kuch naturally positive feel karata hai.

Aur haan, party se bachne ke chakkar me tumne birthday ki date batayi nahi‚Ä¶ lekin hamne phir bhi pata laga liya! Tumhe kya laga, tum nahi bataogi toh hame pata nahi chalega? üòå
Aur party me Sharma wale ka dosa pakka! üòÇüî•

Stay healthy, keep shining, and stay the same forever! ‚ú®

and once again, "Happy Birthday! May your dreams come true," "Wishing you a day filled with love, laughter, and joy," and "Cheers to another year of adventures!".  



jaruri suchna :- ha or jo niche web dev ka kamal dikhaya h uska review jarur dena ki kesa laga 
        </p>

        <div class="hero-meta">
          <div class="pill">Nov 19</div>
          <button class="celebrate-btn" id="celebrateBtn">Celebrate üéä</button>
        </div>
      </div>

      <div class="hero-photo-wrap">
        <!-- hero is clickable -->
        <img src="misha 0.jpeg" class="hero-photo" id="heroPhoto" alt="Misha hero image" data-audio="Tum Se Hi - (Raag.Fm).mp3" data-title="Tum Se Hi">
      </div>
    </section>

    <!-- GALLERY (exactly 4 portrait photos) -->
    <div class="card">
      <h2>üì∏ Memories Gallery</h2>
      <div class="gallery-grid" id="gallery">
        <img src="misha-1.jpg" class="photo" alt="misha photo 1" data-audio="Piyu Bole (Parineeta) - (Raag.Fm) (2).mp3" data-title="Misha - Photo 1">
        <img src="misha 2.jpeg" class="photo" alt="misha photo 2" data-audio="Sawaar Loon - (Raag.Fm) (2).mp3" data-title="Misha - Photo 2">
        <img src="misha 3.jpeg" class="photo" alt="misha photo 3" data-audio="Main Agar Kahoon - (Raag.Fm) (2).mp3" data-title="Misha - Photo 3">
        <img src="misha 4.jpeg" class="photo" alt="misha photo 4" data-audio="Dhoom Taana - (Raag.Fm) (2).mp3" data-title="Misha - Photo 4">
      </div>
    </div>

    <!-- TIMELINE (updated: First Meet on 16 April 2025; removed college fest) -->
    <div class="card">
      <h2>üíñ Memory Timeline</h2>
      <div class="timeline" id="timeline"></div>
    </div>

    <!-- WISHES AT BOTTOM (height matched to hero via --section-height) -->
    <section class="card wishes-card">
      <h2>üéà Birthday Wishes</h2>

      <form class="wishes-form" onsubmit="return false;">
        <input id="wishName" placeholder="Your name (optional)">
        <textarea id="wishText" rows="4" placeholder="Write a wish..."></textarea>

        <button id="postWish" style="width:100%;margin-top:10px;padding:12px;border:none;border-radius:12px;background:#ff4d82;color:white;font-weight:700">
          Post Wish
        </button>

        <button id="clearWishes" style="width:100%;margin-top:8px;padding:10px;border-radius:12px;border:1px solid #eee;background:white">
          Clear All
        </button>
      </form>

      <div id="wishesList" style="margin-top:14px; max-height:250px; overflow:auto"></div>
      <div class="hint" style="margin-top:8px">Tip: Click any photo to view it and listen to its song ‚Äî enjoy the celebration! </div>
    </section>

    <footer>
      Made with ‚ù§Ô∏è for Misha ‚Äî Wished by Priyansh
    </footer>

  </div>

  <!-- Background audio element (replace the file) -->
  <audio id="bgMusic" loop preload="auto">
    <source src="happy-birthday-334876.mp3" type="audio/mpeg">
  </audio>

  <script>
    /* ====== Timeline data (updated) ====== */
    const TIMELINE_DATA = [
      { date: '2025-04-16', title: 'First Meet', text: 'Celebration of Dumb Charade', photo: 'first meet.jpeg' },
      { date: '2025-10-21', title: 'diwali meetup', text: 'The best laughter and chaos üòÑ', photo: 'meet 2.jpeg' }
    ];
    const timeline = document.getElementById('timeline');
    TIMELINE_DATA.forEach(m=>{
      const el = document.createElement('div');
      el.className = 'tm-item';
      el.innerHTML = `
        <div class="tm-thumb"><img src="${m.photo}" alt="${escapeHtml(m.title)}"></div>
        <div>
          <div style="font-weight:700">${escapeHtml(m.title)}</div>
          <div style="font-size:13px;color:var(--muted)">${new Date(m.date).toLocaleDateString()}</div>
          <div style="margin-top:6px">${escapeHtml(m.text)}</div>
        </div>
      `;
      timeline.appendChild(el);
    });

    /* ====== Celebration helpers (rose sparkles + pink petals) ====== */

    // Distribute N points in a rows x cols grid inside rect, with small jitter
    function distributedPositions(count, rect){
      const cols = Math.ceil(Math.sqrt(count));
      const rows = Math.ceil(count / cols);
      const positions = [];
      const cellW = rect.width / cols;
      const cellH = rect.height / rows;
      let idx = 0;
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          if(idx>=count) break;
          // center of cell + small jitter
          const cx = rect.left + c*cellW + cellW/2 + (Math.random()*cellW*0.28 - cellW*0.14);
          const cy = rect.top + r*cellH + cellH/2 + (Math.random()*cellH*0.28 - cellH*0.14);
          positions.push({x: Math.round(cx), y: Math.round(cy)});
          idx++;
        }
      }
      return positions;
    }

    function triggerCelebrationAtRect(rect, opts = {}){
      // default more roses and slower
      const roseCount = opts.roseCount || 28; // increased count
      const petalCount = opts.petalCount || 28;
      const layer = document.getElementById('celebrationLayer');

      // compute distributed positions across rect
      const rosePositions = distributedPositions(roseCount, rect);
      rosePositions.forEach((pos, i) => {
        const span = document.createElement('div');
        span.className = 'rose-emoji';
        span.textContent = 'üåπ';
        const size = 18 + Math.floor(Math.random()*24);
        span.style.fontSize = size + 'px';
        // staggered delays for natural flow
        const delay = Math.floor(Math.random()*450) + (i * 12);
        const dur = 2200 + Math.floor(Math.random()*1200); // slower durations
        span.style.left = (pos.x + (Math.random()*40-20)) + 'px';
        span.style.top = (pos.y + (Math.random()*30-15)) + 'px';
        span.style.animation = `riseFade ${dur}ms cubic-bezier(.2,.8,.2,1) ${delay}ms forwards`;
        layer.appendChild(span);
        setTimeout(()=> span.remove(), dur + delay + 80);
      });

      // petals: spread around rect, slightly below and drift up
      for(let i=0;i<petalCount;i++){
        const p = document.createElement('div');
        p.className = 'petal';
        p.textContent = '‚ùÄ';
        const px = rect.left + Math.random()*rect.width;
        const py = rect.top + rect.height*0.6 + Math.random()*rect.height*0.4;
        p.style.left = px + 'px';
        p.style.top = py + 'px';
        const size = 14 + Math.floor(Math.random()*18);
        p.style.fontSize = size + 'px';
        const dur = 1800 + Math.floor(Math.random()*1600);
        const delay = Math.floor(Math.random()*500);
        p.style.animation = `floatUp ${dur}ms cubic-bezier(.2,.8,.2,1) ${delay}ms forwards`;
        layer.appendChild(p);
        setTimeout(()=> p.remove(), dur + delay + 80);
      }
    }

    // convenience: accepts x,y center and a fallback rect around center
    function triggerCelebration(x,y,opts){
      // if x,y missing use center of viewport
      if(typeof x !== 'number' || typeof y !== 'number'){
        const w = window.innerWidth, h = window.innerHeight;
        x = Math.round(w/2); y = Math.round(h*0.6);
      }
      // create a rect centered at x,y with width proportional to screen (so roses cover photo area)
      const rectW = Math.min(420, Math.round(window.innerWidth * 0.7));
      const rectH = Math.min(420, Math.round(window.innerHeight * 0.5));
      const rect = {
        left: x - rectW/2,
        top: y - rectH/2,
        width: rectW,
        height: rectH
      };
      triggerCelebrationAtRect(rect, opts);
    }

    /* ====== Timeline photo modal (opens timeline image full-screen) ====== */
    (function(){
      const timelineEl = document.getElementById('timeline');
      timelineEl.addEventListener('click', function(e){
        const img = e.target.closest('img');
        if(!img) return;
        const src = img.getAttribute('src');

        // pause bg music if playing, remember state
        const bg = document.getElementById('bgMusic');
        if(bg){
          bg._wasPlaying = !bg.paused;
          if(!bg.paused) bg.pause();
          try{ setMusicState(false); } catch(e){}
        }

        // trigger celebration across the clicked image area (more roses, slow)
        const rect = img.getBoundingClientRect();
        triggerCelebrationAtRect(rect, { roseCount: 28, petalCount: 28 });

        const wrap = document.createElement('div');
        wrap.className = 'modal-wrap';
        wrap.innerHTML = `
          <div class="modal-content" style="max-width:900px;flex-direction:column;align-items:center;">
            <img src="${src}" class="modal-img" style="width:100%;max-height:90vh;object-fit:contain;border-radius:12px;">
            <button id="closeTimelineModal" class="close-btn" style="margin-top:12px;padding:10px 18px;border-radius:8px;border:0">Close</button>
          </div>
        `;
        document.body.appendChild(wrap);

        // close handlers
        document.getElementById('closeTimelineModal').addEventListener('click', closeModal);
        wrap.addEventListener('click', function(ev){ if(ev.target === wrap) closeModal(); });

        function closeModal(){
          wrap.remove();
          // resume background music if it was playing
          if(bg && bg._wasPlaying){
            bg.play().catch(()=>{});
            try{ setMusicState(true); }catch(e){}
          }
        }
      });
    })();

    /* ====== Hero photo modal + audio (click hero to play its song) ====== */
    (function(){
      const heroPhoto = document.getElementById('heroPhoto');
      if(!heroPhoto) return;

      function openHeroModal(e){
        const src = heroPhoto.getAttribute('src');
        const title = heroPhoto.dataset.title || 'Hero Song';
        const audioSrc = heroPhoto.dataset.audio || null;

        // pause bg music (remember)
        const bg = document.getElementById('bgMusic');
        if(bg){
          bg._wasPlaying = !bg.paused;
          if(!bg.paused) bg.pause();
          try { setMusicState(false); } catch(e) {}
        }

        // celebration across hero image area (more roses, slower)
        const rect = heroPhoto.getBoundingClientRect();
        triggerCelebrationAtRect(rect, { roseCount: 34, petalCount: 30 });

        // create modal
        const wrap = document.createElement('div');
        wrap.className = 'modal-wrap';
        wrap.innerHTML = `
          <div class="modal-content" role="dialog" aria-label="Hero modal" style="max-width:1000px;flex-direction:column;align-items:center;">
            <img src="${src}" class="modal-img" style="width:90%;max-height:80vh;object-fit:contain;border-radius:12px;">
            <div style="margin-top:12px; display:flex; gap:10px; align-items:center;">
              <button id="heroModalPlay" style="padding:10px 14px;border-radius:8px;border:none;background:#ff7aa6;color:#fff;font-weight:700">Play</button>
              <button id="heroModalPause" style="padding:10px 14px;border-radius:8px;border:none;background:#fff;color:#ff4d82;font-weight:700">Pause</button>
              <button id="heroModalClose" class="close-btn" style="padding:10px 14px;border-radius:8px;border:0">Close</button>
            </div>
            <div id="heroModalStatus" style="margin-top:8px;color:rgba(255,255,255,0.9)"></div>
          </div>
        `;
        document.body.appendChild(wrap);

        let modalAudio = null;
        const statusDiv = wrap.querySelector('#heroModalStatus');
        function updateStatus(t){ if(statusDiv) statusDiv.textContent = t; }

        if(audioSrc){
          modalAudio = new Audio(audioSrc);
          modalAudio.preload = 'auto';
          modalAudio.volume = 0.85;

          // controls
          wrap.querySelector('#heroModalPlay').addEventListener('click', ()=> {
            modalAudio.play().then(()=> updateStatus('Playing')).catch(()=> updateStatus('Playback blocked ‚Äî press Play again.'));
          });
          wrap.querySelector('#heroModalPause').addEventListener('click', ()=> {
            modalAudio.pause(); updateStatus('Paused');
          });
          wrap.querySelector('#heroModalClose').addEventListener('click', closeModal);

          // when song ends
          modalAudio.addEventListener('ended', ()=> {
            updateStatus('Finished');
            closeModal();
          });

          // try autoplay (user clicked hero so it's treated as gesture)
          modalAudio.play().then(()=> updateStatus('Playing')).catch(()=> updateStatus('Tap Play to listen.'));
        } else {
          wrap.querySelector('#heroModalPlay').disabled = true;
          wrap.querySelector('#heroModalPause').disabled = true;
          updateStatus('No song assigned for hero photo.');
        }

        // close on outside click
        wrap.addEventListener('click', (ev)=> { if(ev.target === wrap) closeModal(); });

        function closeModal(){
          try{ if(modalAudio){ modalAudio.pause(); modalAudio.src = ''; } } catch(e){}
          wrap.remove();
          // resume bg music if it was playing before
          if(bg && bg._wasPlaying){ bg.play().then(()=> setMusicState(true)).catch(()=>{}); }
        }
      }

      // clicking the hero image opens modal and triggers celebration
      heroPhoto.addEventListener('click', openHeroModal);
    })();

    /* ====== Gallery modal + per-photo audio playback + celebration ====== */
    (function(){
      const gallery = document.getElementById('gallery');
      let modalAudio = null;
      let modalWrap = null;

      function stopModalAudio(){
        if(modalAudio){
          try{ modalAudio.pause(); modalAudio.src = ''; } catch(e){}
          modalAudio = null;
        }
      }

      function resumeBgIfNeeded(){
        const bg = document.getElementById('bgMusic');
        if(bg && bg._wasPlaying){
          bg.play().then(()=> setMusicState(true)).catch(()=> setMusicState(false));
        }
      }

      gallery.addEventListener('click', async (e)=>{
        const img = e.target.closest('img.photo');
        if(!img) return;
        const src = img.getAttribute('src');
        const title = img.dataset.title || '';
        const audioSrc = img.dataset.audio || null;

        // pause background music (remember state)
        const bg = document.getElementById('bgMusic');
        if(bg){
          bg._wasPlaying = !bg.paused;
          if(!bg.paused) bg.pause();
          setMusicState(false);
        }

        // celebration at click point (distributed and slow)
        const rect = img.getBoundingClientRect();
        triggerCelebrationAtRect(rect, { roseCount: 28, petalCount: 26 });

        // create modal element
        modalWrap = document.createElement('div');
        modalWrap.className = 'modal-wrap';
        modalWrap.innerHTML = `
          <div class="modal-content" role="dialog" aria-label="Photo modal">
            <img src="${src}" class="modal-img" alt="${escapeHtml(title)}">
            <div class="modal-controls">
              <div class="title">${escapeHtml(title)}</div>
              <div class="hint" style="color:rgba(255,255,255,0.9)">Music for this photo</div>
              <div style="display:flex; gap:8px; margin-top:8px">
                <button id="modalPlay" style="background:#ff7aa6;color:white;padding:10px;border-radius:10px;border:none">Play</button>
                <button id="modalPause" style="background:#fff;color:#ff4d82;padding:10px;border-radius:10px;border:none">Pause</button>
                <button id="modalClose" class="close-btn" style="padding:10px;border-radius:10px;border:0">Close</button>
              </div>
              <div id="modalStatus" style="margin-top:12px; color:rgba(255,255,255,0.9)"></div>
            </div>
          </div>
        `;
        document.body.appendChild(modalWrap);

        // create audio element for modal
        if(audioSrc){
          modalAudio = new Audio(audioSrc);
          modalAudio.preload = 'auto';
          modalAudio.volume = 0.85;
          const statusDiv = modalWrap.querySelector('#modalStatus');
          const playBtn = modalWrap.querySelector('#modalPlay');
          const pauseBtn = modalWrap.querySelector('#modalPause');
          const closeBtn = modalWrap.querySelector('#modalClose');

          function updateStatus(txt){ if(statusDiv) statusDiv.textContent = txt; }

          playBtn.addEventListener('click', ()=>{
            modalAudio.play().then(()=> updateStatus('Playing')).catch(err=> updateStatus('Playback blocked ‚Äî press Play again.'));
          });
          pauseBtn.addEventListener('click', ()=> { modalAudio.pause(); updateStatus('Paused'); });
          closeBtn.addEventListener('click', closeModal);

          modalAudio.addEventListener('ended', ()=> {
            updateStatus('Finished');
            stopModalAudio();
            resumeBgIfNeeded();
          });

          // try autoplay once (user clicked a photo ‚Äî considered user gesture)
          modalAudio.play().then(()=> { modalWrap.querySelector('#modalStatus').textContent = 'Playing'; }).catch(()=> {
            modalWrap.querySelector('#modalStatus').textContent = 'Tap Play to listen.';
          });
        } else {
          modalWrap.querySelector('#modalStatus').textContent = 'No song assigned to this photo';
          modalWrap.querySelector('#modalPlay').disabled = true;
          modalWrap.querySelector('#modalPause').disabled = true;
        }

        // close modal by clicking outside content
        modalWrap.addEventListener('click', (ev)=>{
          if(ev.target === modalWrap) closeModal();
        });

        function closeModal(){
          stopModalAudio();
          modalWrap.remove();
          modalWrap = null;
          resumeBgIfNeeded();
        }
      });

      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }
    })();

    /* ====== Wishes (localStorage) ====== */
    let wishes = JSON.parse(localStorage.getItem('misha_wishes')||'[]');
    const list = document.getElementById('wishesList');
    function renderWishes(){
      list.innerHTML = wishes.length ? wishes.map(w=>`
        <div class="wish">
          <strong>${escapeHtml(w.name)}</strong>
          <div style="margin-top:6px">${escapeHtml(w.message)}</div>
          <div style="font-size:12px;color:var(--muted);margin-top:6px">${new Date(w.time).toLocaleString()}</div>
        </div>`).join('') : `<div style="color:var(--muted)">No wishes yet ‚Äî be the first!</div>`;
    }
    renderWishes();

    document.getElementById('postWish').onclick = ()=>{
      const name = document.getElementById('wishName').value || 'Anonymous';
      const msg = document.getElementById('wishText').value.trim();
      if(!msg) return alert('Write a wish first!');
      wishes.unshift({name:name, message:msg, time:new Date().toISOString()});
      localStorage.setItem('misha_wishes', JSON.stringify(wishes));
      document.getElementById('wishName').value=''; document.getElementById('wishText').value='';
      renderWishes();
    };
    document.getElementById('clearWishes').onclick = ()=>{ if(confirm('Clear all wishes?')){ wishes=[]; localStorage.removeItem('misha_wishes'); renderWishes(); } };

    /* ====== Confetti (pink + white) ‚Äî original burst (kept in case Celebrate used) ====== */
    (function(){
      const canvas = document.createElement('canvas');
      canvas.style.position='fixed'; canvas.style.inset=0; canvas.style.pointerEvents='none'; canvas.style.zIndex=9999;
      document.body.appendChild(canvas);
      const ctx = canvas.getContext('2d');
      let W = canvas.width = innerWidth, H = canvas.height = innerHeight;
      window.addEventListener('resize', ()=>{ W = canvas.width = innerWidth; H = canvas.height = innerHeight; });

      function rand(a,b){ return Math.random()*(b-a)+a; }
      function Conf(){ this.x=rand(0,W); this.y=rand(-H,0); this.w=rand(6,12); this.h=rand(8,18); this.c = Math.random()<0.6 ? 'rgba(255,182,193,0.95)' : 'rgba(255,255,255,0.95)'; this.vx=rand(-1.4,1.4); this.vy=rand(2,5); }
      Conf.prototype.update=function(){ this.x+=this.vx; this.y+=this.vy; if(this.y>H) this.y=rand(-40,-10); }

      let parts=[];
      function burst(){
        parts=[];
        for(let i=0;i<110;i++) parts.push(new Conf());
        loop();
        setTimeout(()=>parts=[],4500);
      }
      function loop(){
        ctx.clearRect(0,0,W,H);
        parts.forEach(p=>{
          ctx.fillStyle = p.c;
          ctx.fillRect(p.x,p.y,p.w,p.h);
          p.update();
        });
        if(parts.length) requestAnimationFrame(loop);
      }

      document.getElementById('celebrateBtn').addEventListener('click', ()=>{
        burst();
        tryPlayMusic(); // attempt to start background music too
      });

      // expose a small burst function for quick celebration (not global but reachable)
      window._smallBurst = function(){
        // spawn fewer particles for photo click celebration
        parts=[];
        for(let i=0;i<60;i++) parts.push(new Conf());
        loop();
        setTimeout(()=>parts=[],2200);
      }
    })();

    /* ====== Background Music Controls ====== */
    const audio = document.getElementById('bgMusic');
    const toggle = document.getElementById('musicToggle');
    const status = document.getElementById('musicStatus');

    function setMusicState(playing){
      toggle.textContent = playing ? 'Pause' : 'Play';
      toggle.setAttribute('aria-pressed', playing ? 'true' : 'false');
      status.textContent = 'Music: ' + (playing ? 'Playing' : 'Paused');
    }

    function tryPlayMusic(){
      if(!audio) return;
      audio.volume = 0.7;
      const p = audio.play();
      if(p && p.then){
        p.then(()=> setMusicState(true)).catch(err=>{
          setMusicState(false);
          console.log('Autoplay blocked or playback prevented:', err);
        });
      } else setMusicState(true);
    }
    function pauseMusic(){ audio.pause(); setMusicState(false); }

    toggle.addEventListener('click', ()=>{
      if(!audio) return;
      if(audio.paused) tryPlayMusic(); else pauseMusic();
    });
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) audio.pause(); });

    /* ====== Helper: escape */
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }
  </script>

</body>
</html>
